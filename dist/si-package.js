var HierarchicalSunburstChartComponent=function(){function a(){a.that=this,this.restrict="EA",this.scope={settings:"=",data:"="},this.template='<div class="main">\n                            <div class="chart">\n                                <div class="explanation" style="visibility: hidden;">\n                                    <span class="spiname"></span><br />\n                                    <span class="percentage"></span><br />\n                                </div>\n                            </div>\n                        </div>'}return a.prototype.link=function(b,c,d){"undefined"==typeof b.settings.height&&(b.settings.height=400),"undefined"==typeof b.settings.width&&(b.settings.width=400),"undefined"==typeof b.settings.colors&&(b.settings.colors={"Skewed Connections":"#3423F3","Span to Depth Ratio":"#5592EF","Element Weights":"#905E54","Procurement Time":"#529683","Super structure Weight":"#9E40CE",spiPass:"#9E40CE",spifail:"#9E40CE","Weight of Beams":"#9E40CE"}),"undefined"==typeof b.data&&(b.data=[]);var e=function(d){a.that.renderComponent(c,b)};window.addEventListener("resize",e),a.that.renderComponent(c,b),b.$watch("data",function(){a.that.renderComponent(c,b)},!0),b.$on("$destroy",function(){window.removeEventListener("resize",e)})},a.prototype.renderComponent=function(a,b){var c=b.data,d=b.settings;this.radius=Math.min(d.width,d.height)/2.5,this.totalSize=0,this.colors=b.settings.colors,this.title=b.settings.title;var e=a.children()[0];this.chartelement=e,e.innerHTML=this.template,this.vis=d3.select(".main").append("svg:svg").attr("width",d.width).attr("height",d.height).append("svg:g").attr("id","container").attr("transform","translate("+d.width/2+","+d.height/2+")"),this.partition=d3.layout.partition().size([2*Math.PI,this.radius*this.radius]).value(function(a){return a.size}),this.arc=d3.svg.arc().startAngle(function(a){return a.x}).endAngle(function(a){return a.x+a.dx}).innerRadius(function(a){return 1==a.depth?Math.sqrt(a.y)+20:Math.sqrt(a.y+a.dy)-5}).outerRadius(function(a){return 1==a.depth?Math.sqrt(a.y)+36:Math.sqrt(a.y)}).cornerRadius(5);var f=this;0!=c.length?f.createVisualization(b.data):(d3.select(e).select(".explanation").style("visibility",""),d3.select(e).select(".spiname").text("NoData"))},a.prototype.createVisualization=function(a){var b=this;this.vis.append("svg:circle").attr("r",this.radius).style("opacity",0);var c=this.partition.nodes(a).filter(function(a){return a.dx>.005}),d=this.vis.data([a]).selectAll("path").data(c).enter().append("g").attr("class","arc");d.append("svg:path").attr("display",function(a){return 1==a.depth&&a.depth?null:"none"}).attr("d",this.arc).attr("fill-rule","evenodd").style("fill",function(a){if("root"!=a.name){var c=b.getAncestors(a);return b.shadeColor(b.colors[c[0].name],-8*c.length)}}).style("opacity",1).on("mouseover",this.mouseover());d3.select(".spiname");d3.select(this.chartelement).select(".spiname").text(this.title),d3.select(this.chartelement).select(".percentage").text(""),d3.select(this.chartelement).select(".explanation").style("visibility",""),d3.select(this.chartelement).select("#container").on("mouseleave",this.mouseleave()),this.totalSize=d.node().__data__.value},a.prototype.shadeColor=function(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(e<255?e<1?0:e:255)+256*(f<255?f<1?0:f:255)+(g<255?g<1?0:g:255)).toString(16).slice(1)},a.prototype.mouseover=function(){var a=this;return function(b,c){var d=a,e=(100*b.value/a.totalSize).toPrecision(3),f=e+"%";e<"0.1"&&(f="< 0.1%"),d3.select(".spiname").text(b.name),d3.select(".percentage").text(f),d3.select(".explanation").style("visibility","");var g=d.getAncestors(b);a.vis.selectAll("path").style("opacity",.3),a.vis.selectAll("path").filter(function(a){if(void 0!=b.children)return b.children.indexOf(a)>=0}).attr("display",null),a.vis.selectAll("path").filter(function(a){return g.indexOf(a)>=0}).style("opacity",1)}},a.prototype.mouseleave=function(){var a=this;return function(b,c){var d=a;a.vis.selectAll("path").on("mouseover",null),a.vis.selectAll("path").transition().duration(1e3).style("opacity",1).attr("display",function(a){return 1==a.depth&&a.depth?null:"none"}).each("end",function(){d3.select(this).on("mouseover",d.mouseover())}),d3.select(".spiname").text(a.title),d3.select(".percentage").text("")}},a.prototype.getAncestors=function(a){for(var b=[],c=a;c.parent;)b.unshift(c),c=c.parent;return b},a.Factory=function(){var b=function(){return new a};return b},a}();angular.module("si.package",[]).directive("hierarchicalSunburstChart",HierarchicalSunburstChartComponent.Factory());var ParcoordsHelper=function(){function a(){}return a.setup=function(a,b,c){var d=this;this.currentPage=0,a.innerHTML="";var e=d3.parcoords()(a);if("function"==typeof b.color)e.color(b.color);else if("RANGE"===b.color.type){var f=b.color,g={color:f.lower.color?f.lower.color:"#de1c22",alpha:1},h={color:f.upper.color?f.upper.color:"#acdd4b",alpha:1};if((g.color.length-1)%4===0){var i=(g.color.length-1)/4,j=g.color.slice(0,-i),k=g.color.substr(g.color.length-i),l=parseInt(k,16)/255;g.color=j,g.alpha=l}if((h.color.length-1)%4===0){var i=(h.color.length-1)/4,m=h.color.slice(0,-i),k=h.color.substr(h.color.length-i),l=parseInt(k,16)/255;h.color=m,h.alpha=l}var n=[f.lower.value,f.upper.value],o=[g,h],p=d3.scale.linear().domain(n).range(o),q=function(a){var b=a[f.axis],c=p(b),e=d.hexToRgb(c.color),g="rgba("+e.r+","+e.g+","+e.b+","+c.alpha+")";return g};e.color(q)}"undefined"==typeof b.alpha?e.alpha(.4):e.alpha(b.alpha),c.then(function(c){if(e.data(c),b.hideAxis&&e.hideAxis(b.hideAxis),e.render(),b.brushingEnabled&&e.brushMode("1D-axes"),b.showGrid){var f=a.nextElementSibling,g=d.createGrid(e,f,c,b);e.on("brush",function(a){g.brush(a)})}b.reorderable===!0&&e.reorderable(),b.flipAxis&&b.flipAxis.length&&e.flipAxis(b.flipAxis)})},a.createGrid=function(a,b,c,d){function e(){var a=d3.keys(c[0]),e=b.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0];if(e.innerHTML="",l.checkbox){var f=document.createElement("th");f.width="20px",f.innerHTML="<input type='checkbox' checked='checked'></input>";var i=f.getElementsByTagName("input")[0];i.addEventListener("change",function(a){c=i.checked?k.slice():[],n()}),e.appendChild(f)}for(var j=g(a,function(a){var b=document.createElement("th");return b.innerHTML=a+"<i></i>",b.addEventListener("mousedown",function(c){h(a);var d=b.getElementsByTagName("i")[0];""===d.className?d.className="icon-chevron_down":"icon-chevron_down"===d.className?d.className="icon-chevron_up":d.className="",n()}),b}),m=0;m<j.length;++m)e.appendChild(j[m]);for(var m=0;m<d.customGridColumns.length;++m){var o=d.customGridColumns[m],f=document.createElement("th");f.innerHTML=o.name,e.appendChild(f)}}function f(){e(),n()}function g(a,b,c,d){c="undefined"==typeof c?a.length:c;for(var e="undefined"==typeof d?0:d,f=e+c>a.length?a.length:e+c,g=[],h=e;h<f;++h){var i=a[h],j=b(i);g.push(j)}return g}function h(a){for(var c=b.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0],d=c.getElementsByTagName("i"),e=0;e<d.length;++e){var f=d[e];f.previousSibling.textContent!==a&&(f.className="")}}function i(a){c=a,h(),n()}var j=this,k=c.slice();"undefined"==typeof d.customGridColumns&&(d.customGridColumns=[]);var l={checkbox:!1},m=10,n=function(){for(var e,f,h=d3.keys(c[0]),i=b.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0],k=i.getElementsByTagName("i"),o=0;o<k.length;++o){var p=k[o];"icon-chevron_down"===p.className?(e=h[o],f=!0):"icon-chevron_up"===p.className&&(e=h[o],f=!1)}var q=c.slice();"undefined"!=typeof e&&(q.sort(function(a,b){return a[e]-b[e]}),f&&q.reverse());var r=b.getElementsByTagName("tbody")[0];r.innerHTML="",j.currentPage<0&&(j.currentPage+=1),j.currentPage*m>=q.length&&(j.currentPage-=1);for(var s=g(q,function(b){var e=h.map(function(a){return b[a]}),f=document.createElement("tr");if("function"==typeof d.gridRowColor&&(f.style.background=d.gridRowColor(b)),l.checkbox){var i=document.createElement("th");i.width="20px",i.innerHTML="<input type='checkbox' checked='checked'></input>";var j=i.getElementsByTagName("input")[0];j.addEventListener("change",function(a){var d=c.indexOf(b);d>-1&&c.splice(d,1),n()}),f.appendChild(i)}for(var k=g(e,function(a){var b=document.createElement("td");return b.innerHTML=a,b}),m=0;m<k.length;++m)f.appendChild(k[m]);for(var m=0;m<d.customGridColumns.length;++m){var o=document.createElement("td");o.appendChild(d.customGridColumns[m].constructor(b)),f.appendChild(o)}return f.addEventListener("mouseover",function(c){a.highlight([b])}),f.addEventListener("mouseout",a.unhighlight),f},m,j.currentPage*m),o=0;o<s.length;++o)r.appendChild(s[o]);var t=j.currentPage*m,u=t+m;u>q.length&&(u=q.length),b.getElementsByTagName("span")[0].textContent=t+1+" - "+u+" of "+q.length};return f(),b.getElementsByClassName("icon-chevron_left")[0].addEventListener("click",function(a){j.currentPage-=1,n()}),b.getElementsByClassName("icon-chevron_right")[0].addEventListener("click",function(a){j.currentPage+=1,n()}),{brush:i}},a.hexToRgb=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},a.template="\n        <div class='parcoords' style='height:200px;'></div>\n        <div class='parcoords-grid'>\n            <table class='table table-hover'>\n                <thead>\n                    <tr></tr>\n                </thead>\n                <tbody></tbody>\n            </table>\n            <div>\n                <i class=\"icon-chevron_left\"></i>\n                <span>\n                </span>\n                <i class=\"icon-chevron_right\"></i>\n            </div>\n        </div>\n    ",a}(),ParcoordDirective=function(){function a(){this.restrict="EA",this.scope={settings:"="},this.template=ParcoordsHelper.template}return a.prototype.link=function(a,b,c){var d=a.settings,e=b[0].firstElementChild,f=d.getData();ParcoordsHelper.setup(e,d,f),window.onresize=function(a){ParcoordsHelper.setup(e,d,f)}},a.Factory=function(){var b=function(){return new a};return b},a}();angular.module("si.package").directive("siParcoords",ParcoordDirective.Factory());var ParallelCoordsChartComponent=function(){function a(){a.that=this,this.restrict="EA",this.scope={control:"=",settings:"=",data:"=",selectedIndices:"="},this.template="<div class='parcoords' style='height:100%'></div>"}return a.prototype.link=function(b,c,d){"undefined"==typeof b.settings.alpha&&(b.settings.alpha=.4),"undefined"==typeof b.settings.flipAxis&&(b.settings.flipAxis=[]),"undefined"==typeof b.settings.hideAxis&&(b.settings.hideAxis=[]),"undefined"==typeof b.data&&(b.data=[]);var e=function(d){a.that.renderComponent(c,b)};window.addEventListener("resize",e),a.that.renderComponent(c,b),b.$watch("data",function(){a.that.renderComponent(c,b)},!0),b.$watch("selectedIndices",function(){a.that.renderComponent(c,b)},!0),b.$on("$destroy",function(){window.removeEventListener("resize",e)})},a.prototype.renderComponent=function(b,c){var d=c.data,e=c.settings,f=c.selectedIndices,g=b.children()[0];g.innerHTML="";var h=d3.parcoords()(g),i=function(){h.screenshot()};if(c.control&&(c.control={saveScreenshot:i}),"undefined"!=typeof e.colorFunction)h.color(e.colorFunction);else if("undefined"!=typeof e.colorRange){var j={color:e.colorRange.lower.color?e.colorRange.lower.color:"#de1c22",alpha:1},k={color:e.colorRange.upper.color?e.colorRange.upper.color:"#acdd4b",alpha:1};if((j.color.length-1)%4===0){var l=(j.color.length-1)/4,m=j.color.slice(0,-l),n=j.color.substr(j.color.length-l),o=parseInt(n,16)/255;j.color=m,j.alpha=o}if((k.color.length-1)%4===0){var l=(k.color.length-1)/4,m=k.color.slice(0,-l),n=k.color.substr(k.color.length-l),o=parseInt(n,16)/255;k.color=m,k.alpha=o}var p=[e.colorRange.lower.value,e.colorRange.upper.value],q=[j,k],r=d3.scale.linear().domain(p).range(q),s=function(b){var c=b[e.colorRange.axis],d=r(c),f=a.hexToRgb(d.color),g="rgba("+f.r+","+f.g+","+f.b+","+d.alpha+")";return g};h.color(s)}h.alpha(e.alpha);var t=[];if(f)for(var u=0;u<f.length;u++){var v=f[u];t.push(d[v])}h.data(t),e.hideAxis.length&&t.length&&h.hideAxis(e.hideAxis),h.render(),e.brushingEnabled&&h.brushMode("1D-axes"),e.reorderable===!0&&h.reorderable(),e.flipAxis.length&&h.flipAxis(e.flipAxis)},a.Factory=function(){var b=function(){return new a};return b},a.hexToRgb=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},a}();angular.module("si.package").directive("parallelCoordsChart",ParallelCoordsChartComponent.Factory());